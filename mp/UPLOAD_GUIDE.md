# 微信小程序上传指南

## 一、已完成的代码压缩优化

### 1. project.config.json 配置优化

已启用以下压缩和优化选项：

| 配置项 | 说明 | 状态 |
|--------|------|------|
| `minified` | JS代码压缩 | ✅ 已启用 |
| `minifyWXSS` | WXSS样式压缩 | ✅ 已启用 |
| `minifyWXML` | WXML模板压缩 | ✅ 已启用 |
| `es6` | ES6转ES5 | ✅ 已启用 |
| `postcss` | CSS后处理 | ✅ 已启用 |
| `uglifyFileName` | 文件名混淆 | ✅ 已启用 |
| `uploadWithSourceMap` | 上传时不包含SourceMap | ✅ 已关闭（减小包体积） |

### 2. 打包排除配置

已配置排除以下文件，减小上传包体积：

- `.gitignore`
- `README.md`
- `*.md` (所有Markdown文件)
- `.git` 文件夹
- `吃啥盲盒小程序原型.html`

### 3. app.json 性能优化

| 配置项 | 说明 |
|--------|------|
| `lazyCodeLoading` | 按需加载组件代码 |
| `initialRenderingCache` | 静态初始渲染缓存，加快首屏 |
| `componentFramework` | 使用 glass-easel 新框架，性能更好 |

---

## 二、上传步骤

### 步骤 1：打开微信开发者工具

1. 打开微信开发者工具
2. 导入项目，选择 `mp` 文件夹
3. 确保 AppID 正确：`wx2f647a16ea239bbc`

### 步骤 2：检查代码

1. 点击工具栏的 **详情** 按钮
2. 在 **本地设置** 中确认以下选项已勾选：
   - ✅ ES6 转 ES5
   - ✅ 增强编译
   - ✅ 使用 npm 模块
   - ✅ 上传代码时自动压缩混淆
   - ✅ 上传代码时自动压缩样式
   - ✅ 上传代码时自动压缩 WXML

### 步骤 3：代码质量检查

1. 点击工具栏的 **代码质量** 按钮
2. 运行代码质量检查，修复所有警告和错误
3. 查看代码依赖分析，确保没有未使用的代码

### 步骤 4：预览测试

1. 点击工具栏的 **预览** 按钮
2. 扫码在真机上测试所有功能
3. 确保功能正常后再上传

### 步骤 5：上传代码

1. 点击工具栏的 **上传** 按钮
2. 填写版本号（如 `1.0.0`）
3. 填写项目备注（描述本次更新内容）
4. 点击 **上传**

### 步骤 6：提交审核

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入 **管理** → **版本管理**
3. 在 **开发版本** 中找到刚上传的版本
4. 点击 **提交审核**
5. 填写审核信息，提交等待审核

---

## 三、包体积优化建议

### 当前项目结构分析

```
mp/
├── pages/          # 页面文件
├── static/         # 静态资源
│   ├── logo.jpeg   # Logo图片
│   └── icons/      # 图标
└── utils/          # 工具函数
```

### 进一步优化建议

1. **图片压缩**
   - 使用 [TinyPNG](https://tinypng.com/) 压缩图片
   - 将 PNG 转换为 WebP 格式（体积更小）

2. **图片云存储**
   - 将大图片上传到云存储（如腾讯云COS）
   - 小程序中使用网络图片URL

3. **代码分包**（如果包体积超过2MB）
   - 将非首页的页面放入分包
   - 配置分包预下载

4. **删除无用代码**
   - 删除未使用的页面和组件
   - 删除调试代码和console.log

---

## 四、常见问题

### Q1: 上传失败，提示包体积超限？

**解决方案：**
1. 检查 static 文件夹中的图片大小
2. 压缩或删除大图片
3. 使用云存储托管图片

### Q2: 上传后功能异常？

**解决方案：**
1. 检查服务器域名是否已配置
2. 在微信公众平台 → 开发 → 开发设置 → 服务器域名 中添加：
   - request合法域名
   - uploadFile合法域名
   - downloadFile合法域名

### Q3: 审核被拒？

**常见原因：**
1. 功能不完整
2. 缺少隐私政策
3. 内容违规
4. 类目不符

---

## 五、版本管理建议

| 版本号 | 说明 |
|--------|------|
| 1.0.0 | 首次发布 |
| 1.0.1 | Bug修复 |
| 1.1.0 | 新功能 |
| 2.0.0 | 重大更新 |

---

## 六、上传前检查清单

- [ ] 所有功能在真机上测试通过
- [ ] 代码质量检查无错误
- [ ] 图片已压缩优化
- [ ] 服务器域名已配置
- [ ] 隐私政策已添加
- [ ] 版本号和备注已填写

祝上传顺利！🎉