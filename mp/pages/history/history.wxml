<wxs module="utils">
  module.exports = {
    getMealTypeName: function(mealType) {
      if (mealType === 1) return 'æ—©é¤';
      if (mealType === 2) return 'åˆé¤';
      if (mealType === 3) return 'æ™šé¤';
      if (mealType === 4) return 'å¤œå®µ';
      return 'ç¾é£Ÿ';
    }
  }
</wxs>

<view class="container-history">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-nav" style="padding-top: {{statusBarHeight}}px;">
    <view class="nav-content" style="height: {{navBarHeight}}px;">
      <view class="nav-left">
        <view class="back-btn" bindtap="goBack">
          <text class="back-icon">â€¹</text>
        </view>
        <text class="page-title">æŠ½é€‰å†å²</text>
      </view>
      <view class="nav-right">
        <view class="nav-right-placeholder" style="width: {{menuButtonWidth}}px;"></view>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view 
    scroll-y 
    class="content-scroll" 
    enhanced="{{true}}" 
    show-scrollbar="{{false}}"
    refresher-enabled="{{true}}"
    bindrefresherrefresh="onPullDownRefresh"
  >
    <!-- åŠ è½½ä¸­ -->
    <view class="loading-container" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-container" wx:elif="{{isEmpty}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-title">æš‚æ— æŠ½é€‰è®°å½•</text>
      <text class="empty-desc">å¿«å»é¦–é¡µæŠ½é€‰ç¾é£Ÿå§ï¼</text>
      <navigator url="/pages/index/index" class="empty-btn">
        <text>å»æŠ½é€‰</text>
      </navigator>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="records-list" wx:else>
      <view class="record-item" wx:for="{{records}}" wx:key="id">
        <view class="record-card">
          <!-- é£Ÿç‰©å›¾ç‰‡ -->
          <view class="food-image-wrapper">
            <image 
              class="food-image" 
              src="{{item.food.image_url}}" 
              mode="aspectFill"
              binderror="onImageError"
              data-index="{{index}}"
            />
            <view class="meal-type-badge">
              <text>{{utils.getMealTypeName(item.food.meal_type)}}</text>
            </view>
          </view>
          
          <!-- é£Ÿç‰©ä¿¡æ¯ -->
          <view class="food-info">
            <text class="food-name">{{item.food.name}}</text>
            <view class="food-meta">
              <view class="food-price">
                <text class="price-symbol">Â¥</text>
                <text class="price-value">{{item.food.price}}</text>
              </view>
              <view class="food-category" wx:if="{{item.food.category}}">
                <text>{{item.food.category}}</text>
              </view>
            </view>
            <text class="food-description" wx:if="{{item.food.description}}">{{item.food.description}}</text>
            <view class="record-time">
              <text class="time-icon">ğŸ•’</text>
              <text class="time-text">{{item.formattedTime}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-bottom"></view>
  </scroll-view>
</view>