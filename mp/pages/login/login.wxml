<view class="container-login">
  <!-- 背景装饰 -->
  <view class="bg-decoration">
    <view class="bg-circle bg-circle-1"></view>
    <view class="bg-circle bg-circle-2"></view>
  </view>
  
  <scroll-view class="login-scroll" scroll-y="true" enhanced="true" show-scrollbar="false">
    <view class="login-card fade-in">
      <view class="content">
        <!-- Logo和标题区域 -->
        <view class="header-section">
          <view class="logo-container">
            <image class="logo-image" src="../../static/logo.jpeg" mode="aspectFill" />
          </view>
          <text class="title">选餐侠</text>
          <text class="subtitle">{{isRegisterMode ? '创建新账号' : '解决你的选择困难症'}}</text>
        </view>
        
        <!-- 微信登录按钮（优先展示） -->
        <view class="wechat-login" wx:if="{{!isRegisterMode}}">
          <button
            class="btn-wechat"
            bindtap="onWechatLogin"
            disabled="{{isWechatLoading}}"
            hover-class="btn-wechat-hover"
          >
            <image class="wechat-icon" src="../../static/icons/wechat.png" mode="aspectFit" />
            <text class="btn-wechat-text">{{isWechatLoading ? '登录中...' : '微信一键登录'}}</text>
          </button>
        </view>
        
        <!-- 分隔线 -->
        <view class="divider" wx:if="{{!isRegisterMode}}">
          <view class="divider-line"></view>
          <text class="divider-text">或使用账号登录</text>
          <view class="divider-line"></view>
        </view>
        
        <!-- 输入表单 -->
        <view class="form-section">
          <view class="input-group">
            <text class="input-icon">👤</text>
            <input
              class="input-field"
              type="text"
              placeholder="用户名（至少3个字符）"
              value="{{username}}"
              bindinput="onUsernameInput"
              maxlength="50"
            />
          </view>
          <view class="input-group">
            <text class="input-icon">🔒</text>
            <input
              class="input-field"
              type="password"
              placeholder="密码（至少6个字符）"
              value="{{password}}"
              bindinput="onPasswordInput"
              maxlength="100"
            />
          </view>
          <view class="input-group" wx:if="{{isRegisterMode}}">
            <text class="input-icon">🔒</text>
            <input
              class="input-field"
              type="password"
              placeholder="确认密码"
              value="{{confirmPassword}}"
              bindinput="onConfirmPasswordInput"
              maxlength="100"
            />
          </view>
        </view>
        
        <!-- 登录/注册按钮 -->
        <view class="actions">
          <button
            class="btn-primary"
            bindtap="{{isRegisterMode ? 'onRegister' : 'onLogin'}}"
            disabled="{{isLoading}}"
            hover-class="btn-primary-hover"
          >
            <text class="btn-text">{{isLoading ? '请稍候...' : (isRegisterMode ? '注册' : '登录')}}</text>
          </button>
          
          <view class="switch-mode" bindtap="toggleMode">
            <text class="switch-text">{{isRegisterMode ? '已有账号？去登录' : '没有账号？去注册'}}</text>
          </view>
        </view>
        
        <!-- 协议提示 -->
        <view class="agreement">
          <text class="agreement-text">登录即表示同意</text>
          <text class="agreement-link" bindtap="onViewAgreement">《用户协议》</text>
          <text class="agreement-text">和</text>
          <text class="agreement-link" bindtap="onViewPrivacy">《隐私政策》</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 用户信息授权弹窗 -->
  <view class="userinfo-modal" wx:if="{{showUserInfoModal}}">
    <view class="modal-mask" bindtap="onSkipUserInfo"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">完善个人信息</text>
        <text class="modal-subtitle">设置头像和昵称，让大家认识你</text>
      </view>
      
      <view class="modal-body">
        <!-- 头像选择 -->
        <view class="avatar-section">
          <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <image
              class="avatar-preview"
              src="{{tempAvatarUrl || '../../static/logo.jpeg'}}"
              mode="aspectFill"
            />
            <view class="avatar-edit-icon">
              <text class="edit-icon-text">📷</text>
            </view>
          </button>
          <text class="avatar-hint">点击选择头像</text>
        </view>
        
        <!-- 昵称输入 -->
        <view class="nickname-section">
          <view class="nickname-input-wrapper">
            <text class="nickname-label">昵称</text>
            <input
              class="nickname-input"
              type="nickname"
              placeholder="请输入昵称"
              value="{{tempNickname}}"
              bindinput="onNicknameInput"
              maxlength="20"
            />
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-skip" bindtap="onSkipUserInfo">跳过</button>
        <button class="btn-confirm" bindtap="onConfirmUserInfo">确认</button>
      </view>
    </view>
  </view>
</view>
